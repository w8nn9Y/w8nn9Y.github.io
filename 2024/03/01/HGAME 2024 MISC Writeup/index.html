<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>HGAME 2024 MISC Writeup | w8nn9z's Blog</title><meta name="author" content="w8nn9z"><meta name="copyright" content="w8nn9z"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一次完整参加四周的新生赛，还是挺有纪念意义的带*的题为赛后复现   HGAME 2024 WEEK11.SignIn下载附件得到一张图片网上搜图看见许多类似的，其中有一张有注释将图片传到手机上从充电口看即可得到flaghgame{WOW_GREAT_YOU_SEE_IT_WONDERFUL}  2.来自星尘的问候 一个即将发售的游戏的主角薇^3带来了一条消息。这段消息隐藏在加密的图片里但即使解">
<meta property="og:type" content="article">
<meta property="og:title" content="HGAME 2024 MISC Writeup">
<meta property="og:url" content="http://example.com/2024/03/01/HGAME%202024%20MISC%20Writeup/index.html">
<meta property="og:site_name" content="w8nn9z&#39;s Blog">
<meta property="og:description" content="第一次完整参加四周的新生赛，还是挺有纪念意义的带*的题为赛后复现   HGAME 2024 WEEK11.SignIn下载附件得到一张图片网上搜图看见许多类似的，其中有一张有注释将图片传到手机上从充电口看即可得到flaghgame{WOW_GREAT_YOU_SEE_IT_WONDERFUL}  2.来自星尘的问候 一个即将发售的游戏的主角薇^3带来了一条消息。这段消息隐藏在加密的图片里但即使解">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/HGAME_2024/HGAME2024.jpg">
<meta property="article:published_time" content="2024-03-01T05:24:36.000Z">
<meta property="article:modified_time" content="2024-09-09T12:31:44.247Z">
<meta property="article:author" content="w8nn9z">
<meta property="article:tag" content="MISC">
<meta property="article:tag" content="writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/HGAME_2024/HGAME2024.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/03/01/HGAME%202024%20MISC%20Writeup/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.14.0-b3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.35/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>(()=>{
      const saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
      
      window.btf = {
        saveToLocal: saveToLocal,
        getScript: (url, attr = {}) => new Promise((resolve, reject) => {
          const script = document.createElement('script')
          script.src = url
          script.async = true
          script.onerror = reject
          script.onload = script.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            script.onload = script.onreadystatechange = null
            resolve()
          }

          Object.keys(attr).forEach(key => {
            script.setAttribute(key, attr[key])
          })

          document.head.appendChild(script)
        }),

        getCSS: (url, id = false) => new Promise((resolve, reject) => {
          const link = document.createElement('link')
          link.rel = 'stylesheet'
          link.href = url
          if (id) link.id = id
          link.onerror = reject
          link.onload = link.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            link.onload = link.onreadystatechange = null
            resolve()
          }
          document.head.appendChild(link)
        }),

        addGlobalFn: (key, fn, name = false, parent = window) => {
          const pjaxEnable = false
          if (!pjaxEnable && key.startsWith('pjax')) return

          const globalFn = parent.globalFn || {}
          const keyObj = globalFn[key] || {}
    
          if (name && keyObj[name]) return
    
          name = name || Object.keys(keyObj).length
          keyObj[name] = fn
          globalFn[key] = keyObj
          parent.globalFn = globalFn
        }
      }
    
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode
      
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'HGAME 2024 MISC Writeup',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-09 20:31:44'
}</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/HGAME_2024/HGAME2024.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="w8nn9z's Blog"><span class="site-name">w8nn9z's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">HGAME 2024 MISC Writeup</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-03-01T05:24:36.000Z" title="Created 2024-03-01 13:24:36">2024-03-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-09-09T12:31:44.247Z" title="Updated 2024-09-09 20:31:44">2024-09-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="HGAME 2024 MISC Writeup"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>第一次完整参加四周的新生赛，还是挺有纪念意义的<br>带*的题为赛后复现</p>
</blockquote>
<hr>
<h1 id="HGAME-2024-WEEK1"><a href="#HGAME-2024-WEEK1" class="headerlink" title="HGAME 2024 WEEK1"></a>HGAME 2024 WEEK1</h1><h3 id="1-SignIn"><a href="#1-SignIn" class="headerlink" title="1.SignIn"></a>1.SignIn</h3><p>下载附件得到一张图片<br><img src="/images/HGAME_2024/WEEK1/try_another_way_to_see.png"><br>网上搜图看见许多类似的，其中有一张有注释<br><img src="/images/HGAME_2024/WEEK1/1.png"><br>将图片传到手机上从充电口看即可得到flag<br>hgame{WOW_GREAT_YOU_SEE_IT_WONDERFUL}</p>
<hr>
<h3 id="2-来自星尘的问候"><a href="#2-来自星尘的问候" class="headerlink" title="2.来自星尘的问候"></a>2.来自星尘的问候</h3><blockquote>
<p>一个即将发售的游戏的主角薇^3带来了一条消息。这段消息隐藏在加密的图片里<br>但即使解开了图片的六位弱加密,看到的也是一张迷惑的图片。<br>也许游戏的官网上有这种文字的记录?<br>补充：flag格式为<code>hgame\&#123;[a-z0-9_]+\&#125;</code></p>
</blockquote>
<p>下载附件得到 <strong>secret.jpg</strong><br><img src="/images/HGAME_2024/WEEK1/secret.jpg"><br><del>不认识但是可爱捏</del><br>网上搜图搜到这样的内容<br><img src="/images/HGAME_2024/WEEK1/2.png"><br>直接搜索下面的文字内容<br><img src="/images/HGAME_2024/WEEK1/3.png"><br>即将发售的游戏为 <strong>来自星尘</strong><br>图片有6位弱加密，猜测为123456</p>
<blockquote>
<p>steghide extract -sf secret.jpg -p 123456</p>
</blockquote>
<p>得到secret.zip<br><img src="/images/HGAME_2024/WEEK1/4.png"><br>exa.png内容：<br><img src="/images/HGAME_2024/WEEK1/exa.png"><br>经过一番搜索才知道这是 <strong>异星文字</strong>（？<br>又经过一番搜索，最终在B站找到较为完整的文字解读<br><img src="/images/HGAME_2024/WEEK1/5.png"><br>根据flag格式和一点推测（有两个异星文字没找到对应字母,c和0）<br>hgame{welc0me!}</p>
<hr>
<h3 id="3-simple-attack"><a href="#3-simple-attack" class="headerlink" title="3.simple_attack"></a>3.simple_attack</h3><blockquote>
<p>怎么解开这个压缩包呢？</p>
</blockquote>
<p>下载附件压缩包 <strong>src.zip</strong><br><img src="/images/HGAME_2024/WEEK1/6.png"><br>src.zip未加密 attchment.zip已加密<br>二者共含文件103223799_p0.jpg<br>基本确定为 <strong>明文攻击</strong><br><strong>ARCHPR</strong> 工具解得密钥<br><img src="/images/HGAME_2024/WEEK1/7.png"><br>保存解开的压缩包并打开<br><img src="/images/HGAME_2024/WEEK1/8.png"><br>photo.txt中含有<strong>DATA URL</strong>,浏览器url输入打开即可<br><img src="/images/HGAME_2024/WEEK1/9.png"></p>
<hr>
<h3 id="4-希儿希儿希尔"><a href="#4-希儿希儿希尔" class="headerlink" title="4.希儿希儿希尔"></a>4.希儿希儿希尔</h3><blockquote>
<p>Ch405是一名忠实的希儿厨，于是他出了一道这样的题，不过他似乎忘了这个加密的名字不是希儿了（x虽然经常有人叫错<br>补充：<br>图片打不开是正常现象,需要修复<br>最终得到的大写字母请用hgame{}包裹</p>
</blockquote>
<p>下载得到secret.png，要进行图片修复，拉到winhex中查看<br><img src="/images/HGAME_2024/WEEK1/11.png"><br><strong>PNG文件头</strong>没问题，可能是宽高被修改过<br>进行<strong>CRC校验</strong>来判断<br>计算CRC校验码之前，需要了解相关内容:<br><strong>头部数据块长度</strong>，<br><strong>文件头数据块标识（IDCH）</strong>,<br><strong>13位数据块（IDHR）</strong><br>剩余四字节为该png的CRC检验码 12 1B 80 4D<br>与我们计算的CRC校验码进行比较<br><img src="/images/HGAME_2024/WEEK1/12.png">显然不同<br>用python脚本修复:<br><img src="/images/HGAME_2024/WEEK1/13.png"><br>得到正确宽高:<br>宽:00 00 05 72<br>高:00 00 07 cf<br>得到修复图片:<br><img src="/images/HGAME_2024/WEEK1/secret_decode.png"><br><del>好看捏</del><br>既然是希尔加密，应该有密钥和密文<br>经过一些尝试，发现<strong>LSB隐写</strong>和<strong>文件分离</strong><br>stegsolve解决LSB隐写问题:<br><img src="/images/HGAME_2024/WEEK1/14.png"><br>binwalk或foremost解决文件分离问题:<br>binwalk -e 图片名.png<br>foremost 图片名.png<br>密文：CVOCRJGMKLDJGBQIUIVXHEYLPNWR<br>在线工具解希尔密码：<br><img src="/images/HGAME_2024/WEEK1/15.png"><br>根据格式提交flag<br>hgame{DISAPPEARINTHESEAOFBUTTERFLY}</p>
<hr>
<h3 id="5-签到"><a href="#5-签到" class="headerlink" title="5.签到"></a>5.签到</h3><p><img src="/images/HGAME_2024/WEEK1/16.png"><br>hgame{welc0me_t0_HGAME_2024}</p>
<hr>
<h1 id="HGAME-2024-WEEK2"><a href="#HGAME-2024-WEEK2" class="headerlink" title="HGAME 2024 WEEK2"></a>HGAME 2024 WEEK2</h1><h3 id="1-ek1ng-want-girlfriend"><a href="#1-ek1ng-want-girlfriend" class="headerlink" title="1.ek1ng_want_girlfriend"></a>1.ek1ng_want_girlfriend</h3><blockquote>
<p>An introducation to Wireshark and also ek1ng.<br>提示1  尝试用Wireshark从HTTP流量中提取文件  </p>
</blockquote>
<p>流量分析，追踪http协议</p>
<p>截获上传的jpg图片内容</p>
<p><img src="/images/HGAME_2024/WEEK2/ek1ng_want_girlfriend/1.png"></p>
<p>导出分组字节流，添加后缀为.jpg，flag在jpg图片底部</p>
<p><img src="/images/HGAME_2024/WEEK2/ek1ng_want_girlfriend/wireshark.jpg"></p>
<hr>
<h3 id="2-ezWord"><a href="#2-ezWord" class="headerlink" title="2.ezWord"></a>2.ezWord</h3><blockquote>
<p>通过破译图片的水印来解开文档里的秘密吧</p>
</blockquote>
<p>压缩包解压缩获得 <strong>这是一个word文档.docx</strong></p>
<p>打开就一张图片，根据题目描述和stegsolve下查看的结果，猜测是盲水印</p>
<p>既然是盲水印，可能要有原图和水印图才能解出水印内容</p>
<p>经过一些尝试，将.docx拖入winhex查看，发现藏了点东西，于是binwalk分离文件</p>
<p><img src="/images/HGAME_2024/WEEK2/ezWord/1.png"></p>
<p>在&#x2F;word&#x2F;media中发现关键信息</p>
<p><img src="/images/HGAME_2024/WEEK2/ezWord/2.png"></p>
<p>获取原图和水印图，进行盲水印的解    使用github上解盲水印的脚本</p>
<p><img src="/images/HGAME_2024/WEEK2/ezWord/3.png"></p>
<p>origin1.jpg和encode1.png是我改的文件名，得到flag.png，查看水印内容</p>
<p><img src="/images/HGAME_2024/WEEK2/ezWord/4.png"></p>
<p><strong>T1hi3sI4sKey</strong>用来解secret.zip这个加密压缩包，得到secret.txt 一段垃圾邮件</p>
<p><img src="/images/HGAME_2024/WEEK2/ezWord/5.png"></p>
<p>ROT8000 解一下出flag</p>
<p><img src="/images/HGAME_2024/WEEK2/ezWord/6.png"></p>
<hr>
<h3 id="3-龙之舞"><a href="#3-龙之舞" class="headerlink" title="3.龙之舞"></a>3.龙之舞</h3><blockquote>
<p>新年快要到了，来看看龙年的龙之舞吧(～￣▽￣)～请注意，拿到<strong>正确</strong>的二维码后解码就是flag 但是一开始未必正确</p>
</blockquote>
<p><strong>deepsound_of_dragon_dance.wav</strong>根据音频文件名猜测进行过<strong>deepsound</strong>隐写</p>
<p>先听了一遍，开头有点异常，关注开头内容，Audacity分析音频内容</p>
<p>频谱图中：<img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/2.png"></p>
<p>鉴定为反了：<img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/decoded.png"></p>
<p>得到KEY也验证了deepsound隐写的想法</p>
<p>解出个<strong>XXX.zip</strong>，里面一个<strong>龙之舞.gif</strong></p>
<p>先看了一遍，右下角有二维码碎片，逐帧分析即可，写个脚本提取每帧图片</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">GIF_name = <span class="string">&quot;dragon.gif&quot;</span></span><br><span class="line">GIF = Image.<span class="built_in">open</span>(GIF_name)</span><br><span class="line">GIF_dir = GIF_name[:-<span class="number">4</span>] + <span class="string">&quot;_BreakDown&quot;</span>  <span class="comment">#[:-4]返回从开头到倒数第五个字符的内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(GIF_dir):</span><br><span class="line">    os.mkdir(GIF_dir)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        GIF_current = GIF.tell()  <span class="comment">#开始为0帧 tell()返回当前帧数</span></span><br><span class="line">        GIF.save(GIF_dir + <span class="string">&quot;\\&quot;</span> + <span class="built_in">str</span>(GIF_current) + <span class="string">&quot;.png&quot;</span>)  <span class="comment">#python中两\\表示一\</span></span><br><span class="line">        GIF.seek(GIF_current + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> EOFError:  <span class="comment">#EOFError是Python中的一个异常类型，表示在读取输入时已经到达了文件的末尾</span></span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment">#pass是空语句，用于保持结构的完整性，不做任何事</span></span><br></pre></td></tr></table></figure>

<p>WPS拼一拼二维码碎片，合成一个大二维码，发现扫不出来</p>
<p><img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/O1234.png"></p>
<p>考虑到每个碎片有两边都是半个方块那么大，应该是两两捆绑的，不存在旋转拼接</p>
<p>正好前两天在复现NCTF 2022 MISC时也有二维码相关内容</p>
<p>当时就在下面网站里学了不少有关二维码的知识</p>
<p><a target="_blank" rel="noopener" href="https://www.wzhecnu.cn/2022/03/22/programming/gsoc/qr-code-01/">https://www.wzhecnu.cn/2022/03/22/programming/gsoc/qr-code-01/</a></p>
<p>经过一些尝试，发现是二维码 <strong>格式信息</strong> 不正确（纠错等级和掩码模式）</p>
<p><img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/QR1.png"><img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/QR2.png"></p>
<p>多次尝试，原本的二维码格式信息应该是 <strong>L4</strong>，扫描得到flag</p>
<p>解题过程中，找到另一种二维码无法扫描类型的题目</p>
<p><strong>第七届“湖湘杯” wear_a_mask</strong>：</p>
<p><img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/7.png"> <img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/8.png"></p>
<p>右图为mask pattern为2时进行的XOR变换</p>
<p>之后我又翻看了去年HGAME 2023 WEEK2 MISC的官方WP，正好对应上面两题</p>
<p><img src="/images/HGAME_2024/WEEK2/%E9%BE%99%E4%B9%8B%E8%88%9E/3.png"></p>
<p>这一题的二维码的收获很多</p>
<hr>
<h1 id="HGAME-2024-WEEK3"><a href="#HGAME-2024-WEEK3" class="headerlink" title="HGAME 2024 WEEK3"></a>HGAME 2024 WEEK3</h1><h3 id="1-简单的vmdk取证"><a href="#1-简单的vmdk取证" class="headerlink" title="1.简单的vmdk取证"></a>1.简单的vmdk取证</h3><blockquote>
<p>先找到密码吧 flag 格式：hgame{nthash_password} 例如hgame{05D0AB2BB13711B31D5E251C128C889E_happy} 附件下载： 链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1IYeZ1oRjo2zO-Wf6mB2TVA">https://pan.baidu.com/s/1IYeZ1oRjo2zO-Wf6mB2TVA</a>  提取码：vics </p>
</blockquote>
<p><strong>.vmdk</strong>——虚拟机-虚拟磁盘文件，记录操作系统中所产生的全部数据</p>
<p>先在VMware中挂载试试，发现需要Administrator的密码</p>
<p>磁盘取证：打开 <strong>DiskGenius</strong> –&gt; 磁盘 –&gt; 打开虚拟磁盘文件</p>
<p><img src="/images/HGAME_2024/WEEK3/%E7%AE%80%E5%8D%95%E7%9A%84vmdk%E5%8F%96%E8%AF%81/1.png"></p>
<p>我们要找的是用户密码，一般储存在 <strong>WINDOWS\system32\config\SAM</strong> 中</p>
<p>将config目录下 <strong>SAM</strong> 和 <strong>system</strong> 复制到指定文件夹</p>
<p><img src="/images/HGAME_2024/WEEK3/%E7%AE%80%E5%8D%95%E7%9A%84vmdk%E5%8F%96%E8%AF%81/2.png"></p>
<p>用 <strong>mimikatz</strong> 获取用户密码hash (注意要将SAM和system复制到mimikatz目录下)</p>
<p>在SAM和system文件后加上后缀 <strong>.hiv</strong>，即可使用mimikatz</p>
<blockquote>
<p>.hiv扩展名：当你使用.hiv扩展名时，Mimikatz会将文件视为注册表文件备份，并使用特定的解析逻辑来读取其中的数据。这意味着在提取和查看密码哈希值时，你需要提供对应的SAM文件和系统文件的备份。</p>
</blockquote>
<p><img src="/images/HGAME_2024/WEEK3/%E7%AE%80%E5%8D%95%E7%9A%84vmdk%E5%8F%96%E8%AF%81/3.png"></p>
<p>Mimikatz对应命令:<code>lsadump::sam /sam:SAM.hiv /system:system.hiv</code></p>
<p>获得Administrator的Hash NTLM，在线工具爆一爆(注意提交flag时需要大写字母)</p>
<p><img src="/images/HGAME_2024/WEEK3/%E7%AE%80%E5%8D%95%E7%9A%84vmdk%E5%8F%96%E8%AF%81/4.png"></p>
<hr>
<h3 id="2-简单的取证-不过前十个有红包"><a href="#2-简单的取证-不过前十个有红包" class="headerlink" title="2.简单的取证,不过前十个有红包"></a>2.简单的取证,不过前十个有红包</h3><blockquote>
<p>找到veracrypt的文件，拿到flag吧 补充附件： 链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/19pj-juLLE4BY0lVxFyO4iQ">https://pan.baidu.com/s/19pj-juLLE4BY0lVxFyO4iQ</a>  提取码：ccyk</p>
</blockquote>
<p>附件内容为 <strong>vera.hc</strong></p>
<blockquote>
<p>.hc 后缀通常与 VeraCrypt 加密软件相关联。VeraCrypt 是一个开源的磁盘加密工具，用于创建和管理加密的容器文件或整个磁盘分区。</p>
<p>当您使用 VeraCrypt 创建加密容器时，它会为容器文件分配一个特定的扩展名，通常是 .hc（即 VeraCrypt Hidden Container 的缩写）。</p>
<p>通过 VeraCrypt 软件，您可以挂载 .hc 容器文件作为一个虚拟磁盘，然后将其视为普通磁盘分区或存储设备。在挂载后，您可以通过输入正确的密码来解密和访问容器中的文件和文件夹。</p>
</blockquote>
<p>于是现在就要获取加密密码，碰巧上一题磁盘中的目录<strong>RECYCLER</strong>中</p>
<p><img src="/images/HGAME_2024/WEEK3/%E7%AE%80%E5%8D%95%E7%9A%84%E5%8F%96%E8%AF%81,%E4%B8%8D%E8%BF%87%E5%89%8D%E5%8D%81%E4%B8%AA%E6%9C%89%E7%BA%A2%E5%8C%85/1.png"></p>
<p>发现有一张jpg图片，上面还写着veracrypt_password，应该就是加密密码</p>
<p><strong>968fJD17UBzZG6e3yjF6</strong> ，打开veracrypt挂载并输入密码，可以得到原磁盘内容</p>
<p>在veracrypt中：选择文件 –&gt; 选个盘符（我选了A） –&gt; 加载 –&gt; 输入密码 –&gt; 确定</p>
<p><img src="/images/HGAME_2024/WEEK3/%E7%AE%80%E5%8D%95%E7%9A%84%E5%8F%96%E8%AF%81,%E4%B8%8D%E8%BF%87%E5%89%8D%E5%8D%81%E4%B8%AA%E6%9C%89%E7%BA%A2%E5%8C%85/2.png"></p>
<hr>
<h3 id="3-与ai聊天"><a href="#3-与ai聊天" class="headerlink" title="3.与ai聊天"></a>3.与ai聊天</h3><blockquote>
<p>跟他聊一聊吧，从他嘴里翘出flag<a target="_blank" rel="noopener" href="https://udify.app/chat/oRajccxObXREMLlO">https://udify.app/chat/oRajccxObXREMLlO</a> 注意请不要过快提问</p>
</blockquote>
<p><img src="/images/HGAME_2024/WEEK3/%E4%B8%8Eai%E8%81%8A%E5%A4%A9/1.png"></p>
<p>发现会反着说，想到hgame能不能反着说完，这样就可以得到flag</p>
<p><img src="/images/HGAME_2024/WEEK3/%E4%B8%8Eai%E8%81%8A%E5%A4%A9/2.png"></p>
<hr>
<h3 id="4-Blind-SQL-Injection"><a href="#4-Blind-SQL-Injection" class="headerlink" title="4.Blind SQL Injection"></a>4.Blind SQL Injection</h3><blockquote>
<p>Blind SQL Injection but in Misc</p>
</blockquote>
<p>附件是一段流量包，判断为流量分析SQL盲注，用wireshark分析</p>
<p>根据SQL盲注特性，过滤出http协议内容，再根据网页回显内容不同，获取所需</p>
<p>举流量里SQL盲注中一句为例</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://3c97f319-92cf-4ba5-a3f2-6bd644abe921.node5.buuoj.cn:81/search.php?id=1-(ascii(substr((Select(reverse(group_concat(password)))From(F1naI1y)),6,1))&gt;31)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>需要注意reverse将获取的password倒置了，写脚本时要再倒置一次</p>
<p>判断 <strong>F1naI1y表</strong> 中 <strong>字段password</strong> 倒置后的第6个字符对应ASCII码是否大于31</p>
<p>经过多次判断查回显，最后可以获得一个 <strong>&gt;x&amp;&amp;&lt;&#x3D;x+1</strong> 的范围，ASCII码即为x+1</p>
<p><img src="/images/HGAME_2024/WEEK3/Blind_SQL_Injection/1.png"></p>
<p>这是当时做题时的分析，也包括了password对应ASCII码的内容(倒置的)</p>
<p>写个简单脚本，得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">125</span>,<span class="number">102</span>,<span class="number">50</span>,<span class="number">102</span>,<span class="number">97</span>,<span class="number">56</span>,<span class="number">50</span>,<span class="number">57</span>,<span class="number">53</span>,<span class="number">99</span>,<span class="number">56</span>,<span class="number">51</span>,<span class="number">100</span>,<span class="number">45</span>,<span class="number">54</span>,<span class="number">99</span>,<span class="number">97</span>,<span class="number">98</span>,<span class="number">45</span>,<span class="number">56</span>,<span class="number">57</span>,<span class="number">101</span>,<span class="number">52</span>,<span class="number">45</span>,<span class="number">53</span>,<span class="number">50</span>,<span class="number">55</span>,<span class="number">49</span>,<span class="number">45</span>,<span class="number">55</span>,<span class="number">101</span>,<span class="number">102</span>,<span class="number">97</span>,<span class="number">98</span>,<span class="number">97</span>,<span class="number">98</span>,<span class="number">99</span>,<span class="number">123</span>,<span class="number">103</span>,<span class="number">97</span>,<span class="number">108</span>,<span class="number">102</span>,<span class="number">44</span>][::-<span class="number">1</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    flag += <span class="built_in">chr</span>(i)</span><br><span class="line"><span class="built_in">print</span> (flag)</span><br></pre></td></tr></table></figure>

<p>运行结果:<img src="/images/HGAME_2024/WEEK3/Blind_SQL_Injection/2.png"></p>
<hr>
<h1 id="HGAME-2024-WEEK4"><a href="#HGAME-2024-WEEK4" class="headerlink" title="HGAME 2024 WEEK4"></a>HGAME 2024 WEEK4</h1><h3 id="1-ezKeyboard"><a href="#1-ezKeyboard" class="headerlink" title="1.ezKeyboard"></a>1.ezKeyboard</h3><blockquote>
<p>本来是个签到题，但有时候往往事与愿违</p>
</blockquote>
<blockquote>
<ol>
<li>流量不需要修复，出题人拿自己电脑现抓的一段流量，他本身就是这样的。</li>
<li>本题键盘流量的 HID Data 格式和常见的格式略有不同，但本质如一。</li>
<li>你需要辩证看待这些个脚本网络上的脚本。他们大多出自一家，没几十行的核心代码里，都毫不例外地保留了数个编程初学者常犯的致命失误。</li>
<li>相信自己的水平，从头写一个脚本往往比找别人的错误容易。</li>
</ol>
</blockquote>
<p>使用wireshark进行USB流量分析，把一些特殊的流量导出</p>
<p>我导出了可能有用的三段，但是有一段不会用，也可能没什么用（</p>
<p>第一段内容：<img src="/images/HGAME_2024/WEEK4/ezKeyboard/1.png"></p>
<p>感觉开头的01没什么用，提取一下敲击内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">normalkeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;a&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;b&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;c&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;d&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;e&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;f&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;g&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;h&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;i&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;j&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;k&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;l&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;m&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;n&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;o&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;p&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;r&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;s&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;t&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;u&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;v&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;w&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;x&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;2&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;3&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;4&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;5&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;6&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;7&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;8&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;9&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;-&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;=&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;[&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;]&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;`&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;,&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;.&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">shiftkeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;A&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;B&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;C&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;D&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;E&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;F&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;G&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;H&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;I&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;J&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;K&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;L&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;M&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;N&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;O&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;P&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;Q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;R&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;S&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;T&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;U&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;V&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;W&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;X&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;Y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;Z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;!&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;@&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;#&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;$&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;%&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;^&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;(&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;)&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;_&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;+&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;|&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;:&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;~&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;?&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;hgame2.txt&#x27;</span>) <span class="keyword">as</span> data:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        information1=line[<span class="number">6</span>:<span class="number">8</span>]</span><br><span class="line">        information2=line[<span class="number">8</span>:<span class="number">10</span>]</span><br><span class="line">        <span class="keyword">if</span> information1==<span class="string">&#x27;00&#x27;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">3</span>]==<span class="string">&#x27;2&#x27;</span>: <span class="comment">#shiftkey</span></span><br><span class="line">            <span class="built_in">print</span> (shiftkeys[information1],end=<span class="string">&#x27;&#x27;</span>) <span class="comment">#end=&#x27;&#x27;以空字符替换原默认换行符</span></span><br><span class="line">            <span class="keyword">if</span> information2!=<span class="string">&#x27;00&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span> (shiftkeys[information2],end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">3</span>]==<span class="string">&#x27;0&#x27;</span>: <span class="comment">#normalkey</span></span><br><span class="line">            <span class="built_in">print</span> (normalkeys[information1],end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> information2!=<span class="string">&#x27;00&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span> (normalkeys[information2],end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;k_&lt;DEL&gt;e&lt;CAP&gt;&lt;CAP&gt;y&lt;CAP&gt;&lt;CAP&gt;b0a1d&lt;CAP&gt;&lt;CAP&gt;&lt;CAP&gt;_&lt;CAP&gt;&lt;CAP&gt;gam0&lt;CAP&gt;&lt;CAP&gt;&lt;CAP&gt;_&lt;CAP&gt;&lt;CAP&gt;_&lt;CAP&gt;&lt;CAP&gt;15&lt;CAP&gt;&lt;CAP&gt;&lt;CAP&gt;_&lt;CAP&gt;&lt;CAP&gt;s0&lt;CAP&gt;&lt;CAP&gt;&lt;CAP&gt;_&lt;CAP&gt;&lt;CAP&gt;&lt;CAP&gt;1nst&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;f0n__!!~~&lt;CAP&gt;~~&lt;CAP&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>整理一下：<img src="/images/HGAME_2024/WEEK4/ezKeyboard/2.png"></p>
<p>但是提交发现flag不对，感觉怪怪的</p>
<p>赛后看了官方wp找到问题了，这里也贴出能得到正确flag的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">normalKeys = &#123;<span class="string">&quot;04&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;05&quot;</span>: <span class="string">&quot;b&quot;</span>, <span class="string">&quot;06&quot;</span>: <span class="string">&quot;c&quot;</span>, <span class="string">&quot;07&quot;</span>: <span class="string">&quot;d&quot;</span>, <span class="string">&quot;08&quot;</span>: <span class="string">&quot;e&quot;</span>, <span class="string">&quot;09&quot;</span>:</span><br><span class="line"><span class="string">&quot;f&quot;</span>, <span class="string">&quot;0a&quot;</span>: <span class="string">&quot;g&quot;</span>, <span class="string">&quot;0b&quot;</span>: <span class="string">&quot;h&quot;</span>, <span class="string">&quot;0c&quot;</span>: <span class="string">&quot;i&quot;</span>,</span><br><span class="line"><span class="string">&quot;0d&quot;</span>: <span class="string">&quot;j&quot;</span>, <span class="string">&quot;0e&quot;</span>: <span class="string">&quot;k&quot;</span>, <span class="string">&quot;0f&quot;</span>: <span class="string">&quot;l&quot;</span>, <span class="string">&quot;10&quot;</span>: <span class="string">&quot;m&quot;</span>, <span class="string">&quot;11&quot;</span>: <span class="string">&quot;n&quot;</span>, <span class="string">&quot;12&quot;</span>:</span><br><span class="line"><span class="string">&quot;o&quot;</span>, <span class="string">&quot;13&quot;</span>: <span class="string">&quot;p&quot;</span>, <span class="string">&quot;14&quot;</span>: <span class="string">&quot;q&quot;</span>, <span class="string">&quot;15&quot;</span>: <span class="string">&quot;r&quot;</span>,</span><br><span class="line"><span class="string">&quot;16&quot;</span>: <span class="string">&quot;s&quot;</span>, <span class="string">&quot;17&quot;</span>: <span class="string">&quot;t&quot;</span>, <span class="string">&quot;18&quot;</span>: <span class="string">&quot;u&quot;</span>, <span class="string">&quot;19&quot;</span>: <span class="string">&quot;v&quot;</span>, <span class="string">&quot;1a&quot;</span>: <span class="string">&quot;w&quot;</span>, <span class="string">&quot;1b&quot;</span>:</span><br><span class="line"><span class="string">&quot;x&quot;</span>, <span class="string">&quot;1c&quot;</span>: <span class="string">&quot;y&quot;</span>, <span class="string">&quot;1d&quot;</span>: <span class="string">&quot;z&quot;</span>, <span class="string">&quot;1e&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"><span class="string">&quot;1f&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;20&quot;</span>: <span class="string">&quot;3&quot;</span>, <span class="string">&quot;21&quot;</span>: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;22&quot;</span>: <span class="string">&quot;5&quot;</span>, <span class="string">&quot;23&quot;</span>: <span class="string">&quot;6&quot;</span>, <span class="string">&quot;24&quot;</span>:</span><br><span class="line"><span class="string">&quot;7&quot;</span>, <span class="string">&quot;25&quot;</span>: <span class="string">&quot;8&quot;</span>, <span class="string">&quot;26&quot;</span>: <span class="string">&quot;9&quot;</span>, <span class="string">&quot;27&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="string">&quot;28&quot;</span>: <span class="string">&quot;&lt;RET&gt;&quot;</span>, <span class="string">&quot;29&quot;</span>: <span class="string">&quot;&lt;ESC&gt;&quot;</span>, <span class="string">&quot;2a&quot;</span>: <span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>: <span class="string">&quot;\t&quot;</span>, <span class="string">&quot;2c&quot;</span>: <span class="string">&quot;&lt;SPACE&gt;&quot;</span>, <span class="string">&quot;2d&quot;</span>: <span class="string">&quot;-&quot;</span>, <span class="string">&quot;2e&quot;</span>: <span class="string">&quot;=&quot;</span>, <span class="string">&quot;2f&quot;</span>: <span class="string">&quot;[&quot;</span>,</span><br><span class="line"><span class="string">&quot;30&quot;</span>: <span class="string">&quot;]&quot;</span>, <span class="string">&quot;31&quot;</span>: <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;32&quot;</span>: <span class="string">&quot;&lt;NON&gt;&quot;</span>, <span class="string">&quot;33&quot;</span>: <span class="string">&quot;;&quot;</span>, <span class="string">&quot;34&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>,</span><br><span class="line"><span class="string">&quot;35&quot;</span>: <span class="string">&quot;&lt;GA&gt;&quot;</span>, <span class="string">&quot;36&quot;</span>: <span class="string">&quot;,&quot;</span>, <span class="string">&quot;37&quot;</span>: <span class="string">&quot;.&quot;</span>, <span class="string">&quot;38&quot;</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line"><span class="string">&quot;39&quot;</span>: <span class="string">&quot;&lt;CAP&gt;&quot;</span>, <span class="string">&quot;3a&quot;</span>: <span class="string">&quot;&lt;F1&gt;&quot;</span>, <span class="string">&quot;3b&quot;</span>: <span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>: <span class="string">&quot;&lt;F3&gt;&quot;</span>, <span class="string">&quot;3d&quot;</span>: <span class="string">&quot;&lt;F4&gt;&quot;</span>, <span class="string">&quot;3e&quot;</span>: <span class="string">&quot;&lt;F5&gt;&quot;</span>, <span class="string">&quot;3f&quot;</span>: <span class="string">&quot;&lt;F6&gt;&quot;</span>,</span><br><span class="line"><span class="string">&quot;40&quot;</span>: <span class="string">&quot;&lt;F7&gt;&quot;</span>, <span class="string">&quot;41&quot;</span>: <span class="string">&quot;&lt;F8&gt;&quot;</span>, <span class="string">&quot;42&quot;</span>: <span class="string">&quot;&lt;F9&gt;&quot;</span>, <span class="string">&quot;43&quot;</span>: <span class="string">&quot;&lt;F10&gt;&quot;</span>, <span class="string">&quot;44&quot;</span>: <span class="string">&quot;&lt;F11&gt;&quot;</span>, <span class="string">&quot;45&quot;</span>: <span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">shiftKeys = &#123;<span class="string">&quot;04&quot;</span>: <span class="string">&quot;A&quot;</span>, <span class="string">&quot;05&quot;</span>: <span class="string">&quot;B&quot;</span>, <span class="string">&quot;06&quot;</span>: <span class="string">&quot;C&quot;</span>, <span class="string">&quot;07&quot;</span>: <span class="string">&quot;D&quot;</span>, <span class="string">&quot;08&quot;</span>: <span class="string">&quot;E&quot;</span>, <span class="string">&quot;09&quot;</span>: <span class="string">&quot;F&quot;</span>,</span><br><span class="line"><span class="string">&quot;0a&quot;</span>: <span class="string">&quot;G&quot;</span>, <span class="string">&quot;0b&quot;</span>: <span class="string">&quot;H&quot;</span>, <span class="string">&quot;0c&quot;</span>: <span class="string">&quot;I&quot;</span>,</span><br><span class="line"><span class="string">&quot;0d&quot;</span>: <span class="string">&quot;J&quot;</span>, <span class="string">&quot;0e&quot;</span>: <span class="string">&quot;K&quot;</span>, <span class="string">&quot;0f&quot;</span>: <span class="string">&quot;L&quot;</span>, <span class="string">&quot;10&quot;</span>: <span class="string">&quot;M&quot;</span>, <span class="string">&quot;11&quot;</span>: <span class="string">&quot;N&quot;</span>, <span class="string">&quot;12&quot;</span>: <span class="string">&quot;O&quot;</span>,</span><br><span class="line"><span class="string">&quot;13&quot;</span>: <span class="string">&quot;P&quot;</span>, <span class="string">&quot;14&quot;</span>: <span class="string">&quot;Q&quot;</span>, <span class="string">&quot;15&quot;</span>: <span class="string">&quot;R&quot;</span>,</span><br><span class="line"><span class="string">&quot;16&quot;</span>: <span class="string">&quot;S&quot;</span>, <span class="string">&quot;17&quot;</span>: <span class="string">&quot;T&quot;</span>, <span class="string">&quot;18&quot;</span>: <span class="string">&quot;U&quot;</span>, <span class="string">&quot;19&quot;</span>: <span class="string">&quot;V&quot;</span>, <span class="string">&quot;1a&quot;</span>: <span class="string">&quot;W&quot;</span>, <span class="string">&quot;1b&quot;</span>: <span class="string">&quot;X&quot;</span>,</span><br><span class="line"><span class="string">&quot;1c&quot;</span>: <span class="string">&quot;Y&quot;</span>, <span class="string">&quot;1d&quot;</span>: <span class="string">&quot;Z&quot;</span>, <span class="string">&quot;1e&quot;</span>: <span class="string">&quot;!&quot;</span>,</span><br><span class="line"><span class="string">&quot;1f&quot;</span>: <span class="string">&quot;@&quot;</span>, <span class="string">&quot;20&quot;</span>: <span class="string">&quot;#&quot;</span>, <span class="string">&quot;21&quot;</span>: <span class="string">&quot;$&quot;</span>, <span class="string">&quot;22&quot;</span>: <span class="string">&quot;%&quot;</span>, <span class="string">&quot;23&quot;</span>: <span class="string">&quot;^&quot;</span>, <span class="string">&quot;24&quot;</span>: <span class="string">&quot;&amp;&quot;</span>,</span><br><span class="line"><span class="string">&quot;25&quot;</span>: <span class="string">&quot;*&quot;</span>, <span class="string">&quot;26&quot;</span>: <span class="string">&quot;(&quot;</span>, <span class="string">&quot;27&quot;</span>: <span class="string">&quot;)&quot;</span>,</span><br><span class="line"><span class="string">&quot;28&quot;</span>: <span class="string">&quot;&lt;RET&gt;&quot;</span>, <span class="string">&quot;29&quot;</span>: <span class="string">&quot;&lt;ESC&gt;&quot;</span>, <span class="string">&quot;2a&quot;</span>: <span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>: <span class="string">&quot;\t&quot;</span>, <span class="string">&quot;2c&quot;</span>: <span class="string">&quot;&lt;SPACE&gt;&quot;</span>, <span class="string">&quot;2d&quot;</span>: <span class="string">&quot;_&quot;</span>, <span class="string">&quot;2e&quot;</span>: <span class="string">&quot;+&quot;</span>, <span class="string">&quot;2f&quot;</span>: <span class="string">&quot;&#123;&quot;</span>,</span><br><span class="line"><span class="string">&quot;30&quot;</span>: <span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;31&quot;</span>: <span class="string">&quot;|&quot;</span>, <span class="string">&quot;32&quot;</span>: <span class="string">&quot;&lt;NON&gt;&quot;</span>, <span class="string">&quot;33&quot;</span>: <span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;34&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;35&quot;</span>:</span><br><span class="line"><span class="string">&quot;~&quot;</span>, <span class="string">&quot;36&quot;</span>: <span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;37&quot;</span>: <span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;38&quot;</span>: <span class="string">&quot;?&quot;</span>,</span><br><span class="line"><span class="string">&quot;39&quot;</span>: <span class="string">&quot;&lt;CAP&gt;&quot;</span>, <span class="string">&quot;3a&quot;</span>: <span class="string">&quot;&lt;F1&gt;&quot;</span>, <span class="string">&quot;3b&quot;</span>: <span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>: <span class="string">&quot;&lt;F3&gt;&quot;</span>, <span class="string">&quot;3d&quot;</span>: <span class="string">&quot;&lt;F4&gt;&quot;</span>, <span class="string">&quot;3e&quot;</span>: <span class="string">&quot;&lt;F5&gt;&quot;</span>, <span class="string">&quot;3f&quot;</span>: <span class="string">&quot;&lt;F6&gt;&quot;</span>,</span><br><span class="line"><span class="string">&quot;40&quot;</span>: <span class="string">&quot;&lt;F7&gt;&quot;</span>, <span class="string">&quot;41&quot;</span>: <span class="string">&quot;&lt;F8&gt;&quot;</span>, <span class="string">&quot;42&quot;</span>: <span class="string">&quot;&lt;F9&gt;&quot;</span>, <span class="string">&quot;43&quot;</span>: <span class="string">&quot;&lt;F10&gt;&quot;</span>, <span class="string">&quot;44&quot;</span>: <span class="string">&quot;&lt;F11&gt;&quot;</span>, <span class="string">&quot;45&quot;</span>: <span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">output = []</span><br><span class="line">last = []</span><br><span class="line">new = []</span><br><span class="line">keys = <span class="built_in">open</span>(<span class="string">&#x27;hgame2.txt&#x27;</span>)</span><br><span class="line">press = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">2</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> (line[<span class="number">3</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> line[<span class="number">3</span>]!=<span class="string">&#x27;2&#x27;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        offset = <span class="number">6</span></span><br><span class="line">        new = []</span><br><span class="line">        <span class="keyword">while</span> line[offset:offset+<span class="number">2</span>] != <span class="string">&#x27;00&#x27;</span>:</span><br><span class="line">            press = line[offset:offset+<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">if</span> press <span class="keyword">in</span> normalKeys.keys():</span><br><span class="line">                <span class="keyword">if</span> line[<span class="number">3</span>]==<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                    key = normalKeys[press]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    key = shiftKeys[press]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                key = <span class="string">&#x27;[unknown]&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> press <span class="keyword">not</span> <span class="keyword">in</span> last:</span><br><span class="line">                output.append(key)</span><br><span class="line">            new.append(press)</span><br><span class="line">            offset += <span class="number">2</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(line)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        last = new</span><br><span class="line"></span><br><span class="line">keys.close()</span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> output[i]==<span class="string">&quot;&lt;CAP&gt;&quot;</span>:</span><br><span class="line">            flag = <span class="number">1</span>-flag</span><br><span class="line">        <span class="keyword">if</span> flag!=<span class="number">0</span>:</span><br><span class="line">            output[i]=output[i].upper()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">output = [x <span class="keyword">for</span> x <span class="keyword">in</span> output <span class="keyword">if</span> x != <span class="string">&#x27;&lt;CAP&gt;&#x27;</span>]</span><br><span class="line"></span><br><span class="line">new_output = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line">    <span class="keyword">if</span> output[i] == <span class="string">&quot;&lt;DEL&gt;&quot;</span>:</span><br><span class="line">        new_output = new_output[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        new_output.append(output[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;&quot;</span>.join(new_output))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行结果:hgame{keYb0a1d_gam0__15_s0_f0n__!!~~~~}</p>
<hr>
<h3 id="2-maybezip"><a href="#2-maybezip" class="headerlink" title="2.maybezip *"></a>2.maybezip *</h3><p>根据题目名，结合文件并非zip，想到需要对文件内容异或得到原zip文件<br>根据zip文件的固定文件头，504B0304，找到异或数字 0x27,可以直接在winhex里异或，也能写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">xor_with_0x27</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    xor_data = <span class="built_in">bytearray</span>([b ^ <span class="number">0x27</span> <span class="keyword">for</span> b <span class="keyword">in</span> data])</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(xor_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用xor函数</span></span><br><span class="line">xor_with_0x27(<span class="string">&#x27;maybezip&#x27;</span>, <span class="string">&#x27;output.zip&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>output.zip里文件修改日期有明显的01特征，提取出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_all_file_modification_time</span>(<span class="params">zip_path</span>):</span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    <span class="keyword">with</span> zipfile.ZipFile(zip_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> myzip:</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> myzip.namelist():</span><br><span class="line">            info = myzip.getinfo(file)</span><br><span class="line">            mod_time = datetime(*info.date_time)</span><br><span class="line">            result[file] = <span class="built_in">str</span>(mod_time)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用函数并保存结果为json</span></span><br><span class="line">result = get_all_file_modification_time(<span class="string">&#x27;output.zip&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(result, f)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再对拿到的json数据操作一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取json文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br><span class="line">string_of_01 =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 遍历json数据</span></span><br><span class="line"><span class="keyword">for</span> file, time <span class="keyword">in</span> data.items():</span><br><span class="line">    <span class="comment"># 检查文件名是否在指定范围内</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;out/&#x27;</span> <span class="keyword">in</span> file <span class="keyword">and</span> <span class="string">&#x27;png&#x27;</span> <span class="keyword">in</span> file:</span><br><span class="line">        file_number = <span class="built_in">int</span>(file.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> file_number &gt;= <span class="number">1</span> <span class="keyword">and</span> file_number &lt;= <span class="number">118</span>:</span><br><span class="line">            <span class="comment"># 检查时间的最后一位是否为0</span></span><br><span class="line">            <span class="keyword">if</span> time[-<span class="number">1</span>] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;file_number&#125;</span> - 0&quot;</span>)</span><br><span class="line">                string_of_01 += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;file_number&#125;</span> - 1&quot;</span>)</span><br><span class="line">                string_of_01 += <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(string_of_01)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二进制转ascii字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binary_to_string</span>(<span class="params">binary</span>):</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary), <span class="number">8</span>):</span><br><span class="line">        byte = binary[i:i+<span class="number">8</span>]</span><br><span class="line">        result += <span class="built_in">chr</span>(<span class="built_in">int</span>(byte,<span class="number">2</span>))  <span class="comment">#从二进制转为十进制</span></span><br><span class="line">    <span class="comment"># 忽略不可见字符</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span>.join([i <span class="keyword">if</span> <span class="built_in">ord</span>(i) &gt; <span class="number">31</span> <span class="keyword">and</span> <span class="built_in">ord</span>(i) &lt; <span class="number">127</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> result])</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">key_of_zip = binary_to_string(string_of_01)</span><br><span class="line"><span class="built_in">print</span>(key_of_zip)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到压缩包密码 what_is_tupper<br>解压缩得到一段数字，结合压缩包密码的tupper，想到tupper自指，在线工具画一下图</p>
<p><img src="/images/HGAME_2024/WEEK4/maybezip/1.png"></p>
<p>这是micro qrcode，找个工具扫一下，可以用Scanbot SDK<br>扫描内容为：Matryo5hk4_d01l</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">w8nn9z</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/03/01/HGAME%202024%20MISC%20Writeup/">http://example.com/2024/03/01/HGAME%202024%20MISC%20Writeup/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MISC/">MISC</a><a class="post-meta__tags" href="/tags/writeup/">writeup</a></div><div class="post_share"><div class="social-share" data-image="/images/HGAME_2024/HGAME2024.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/07/21/DASCTF%202024%E6%9A%91%E6%9C%9F%E6%8C%91%E6%88%98%E8%B5%9B%20MISC%20Writeup/" title="DASCTF 2024暑期挑战赛 MISC Writeup"><img class="cover" src="/images/DASCTF_2024_summer/cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">DASCTF 2024暑期挑战赛 MISC Writeup</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/08/26/NepCTF%202024%20MISC%20Writeup/" title="NepCTF 2024 MISC Writeup"><img class="cover" src="/images/NepCTF_2024/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-26</div><div class="title">NepCTF 2024 MISC Writeup</div></div></a></div><div><a href="/2024/09/08/%E9%95%BF%E5%9F%8E%E6%9D%AF%202024%20MISC%20Writeup/" title="长城杯 2024 MISC Writeup"><img class="cover" src="/images/%E9%95%BF%E5%9F%8E%E6%9D%AF2024/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-08</div><div class="title">长城杯 2024 MISC Writeup</div></div></a></div><div><a href="/2024/08/21/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%202024%20MISC%20Writeup/" title="巅峰极客 2024 MISC Writeup"><img class="cover" src="/images/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-21</div><div class="title">巅峰极客 2024 MISC Writeup</div></div></a></div><div><a href="/2024/08/10/MoeCTF%202024%20Writeup/" title="MoeCTF 2024 Writeup"><img class="cover" src="/images/MoeCTF_2024/MoeCTF_2024.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-10</div><div class="title">MoeCTF 2024 Writeup</div></div></a></div><div><a href="/2024/07/21/DASCTF%202024%E6%9A%91%E6%9C%9F%E6%8C%91%E6%88%98%E8%B5%9B%20MISC%20Writeup/" title="DASCTF 2024暑期挑战赛 MISC Writeup"><img class="cover" src="/images/DASCTF_2024_summer/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-21</div><div class="title">DASCTF 2024暑期挑战赛 MISC Writeup</div></div></a></div><div><a href="/2024/09/11/WMCTF%202024%20Forensics%20%E5%A4%8D%E7%8E%B0/" title="WMCTF 2024 Forensics 复现"><img class="cover" src="/images/WMCTF_2024/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-11</div><div class="title">WMCTF 2024 Forensics 复现</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">w8nn9z</div><div class="author-info__description">__0rrrrzz__</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HGAME-2024-WEEK1"><span class="toc-number">1.</span> <span class="toc-text">HGAME 2024 WEEK1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-SignIn"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.SignIn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9D%A5%E8%87%AA%E6%98%9F%E5%B0%98%E7%9A%84%E9%97%AE%E5%80%99"><span class="toc-number">1.0.2.</span> <span class="toc-text">2.来自星尘的问候</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-simple-attack"><span class="toc-number">1.0.3.</span> <span class="toc-text">3.simple_attack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%B8%8C%E5%84%BF%E5%B8%8C%E5%84%BF%E5%B8%8C%E5%B0%94"><span class="toc-number">1.0.4.</span> <span class="toc-text">4.希儿希儿希尔</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%AD%BE%E5%88%B0"><span class="toc-number">1.0.5.</span> <span class="toc-text">5.签到</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HGAME-2024-WEEK2"><span class="toc-number">2.</span> <span class="toc-text">HGAME 2024 WEEK2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ek1ng-want-girlfriend"><span class="toc-number">2.0.1.</span> <span class="toc-text">1.ek1ng_want_girlfriend</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ezWord"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.ezWord</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%BE%99%E4%B9%8B%E8%88%9E"><span class="toc-number">2.0.3.</span> <span class="toc-text">3.龙之舞</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HGAME-2024-WEEK3"><span class="toc-number">3.</span> <span class="toc-text">HGAME 2024 WEEK3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E7%9A%84vmdk%E5%8F%96%E8%AF%81"><span class="toc-number">3.0.1.</span> <span class="toc-text">1.简单的vmdk取证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%AE%80%E5%8D%95%E7%9A%84%E5%8F%96%E8%AF%81-%E4%B8%8D%E8%BF%87%E5%89%8D%E5%8D%81%E4%B8%AA%E6%9C%89%E7%BA%A2%E5%8C%85"><span class="toc-number">3.0.2.</span> <span class="toc-text">2.简单的取证,不过前十个有红包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%8Eai%E8%81%8A%E5%A4%A9"><span class="toc-number">3.0.3.</span> <span class="toc-text">3.与ai聊天</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Blind-SQL-Injection"><span class="toc-number">3.0.4.</span> <span class="toc-text">4.Blind SQL Injection</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HGAME-2024-WEEK4"><span class="toc-number">4.</span> <span class="toc-text">HGAME 2024 WEEK4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ezKeyboard"><span class="toc-number">4.0.1.</span> <span class="toc-text">1.ezKeyboard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-maybezip"><span class="toc-number">4.0.2.</span> <span class="toc-text">2.maybezip *</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/11/WMCTF%202024%20Forensics%20%E5%A4%8D%E7%8E%B0/" title="WMCTF 2024 Forensics 复现"><img src="/images/WMCTF_2024/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WMCTF 2024 Forensics 复现"/></a><div class="content"><a class="title" href="/2024/09/11/WMCTF%202024%20Forensics%20%E5%A4%8D%E7%8E%B0/" title="WMCTF 2024 Forensics 复现">WMCTF 2024 Forensics 复现</a><time datetime="2024-09-11T11:53:14.000Z" title="Created 2024-09-11 19:53:14">2024-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/08/%E9%95%BF%E5%9F%8E%E6%9D%AF%202024%20MISC%20Writeup/" title="长城杯 2024 MISC Writeup"><img src="/images/%E9%95%BF%E5%9F%8E%E6%9D%AF2024/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="长城杯 2024 MISC Writeup"/></a><div class="content"><a class="title" href="/2024/09/08/%E9%95%BF%E5%9F%8E%E6%9D%AF%202024%20MISC%20Writeup/" title="长城杯 2024 MISC Writeup">长城杯 2024 MISC Writeup</a><time datetime="2024-09-08T10:23:47.000Z" title="Created 2024-09-08 18:23:47">2024-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/26/NepCTF%202024%20MISC%20Writeup/" title="NepCTF 2024 MISC Writeup"><img src="/images/NepCTF_2024/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NepCTF 2024 MISC Writeup"/></a><div class="content"><a class="title" href="/2024/08/26/NepCTF%202024%20MISC%20Writeup/" title="NepCTF 2024 MISC Writeup">NepCTF 2024 MISC Writeup</a><time datetime="2024-08-26T03:42:11.000Z" title="Created 2024-08-26 11:42:11">2024-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/21/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%202024%20MISC%20Writeup/" title="巅峰极客 2024 MISC Writeup"><img src="/images/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="巅峰极客 2024 MISC Writeup"/></a><div class="content"><a class="title" href="/2024/08/21/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%202024%20MISC%20Writeup/" title="巅峰极客 2024 MISC Writeup">巅峰极客 2024 MISC Writeup</a><time datetime="2024-08-21T06:40:28.000Z" title="Created 2024-08-21 14:40:28">2024-08-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/10/MoeCTF%202024%20Writeup/" title="MoeCTF 2024 Writeup"><img src="/images/MoeCTF_2024/MoeCTF_2024.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MoeCTF 2024 Writeup"/></a><div class="content"><a class="title" href="/2024/08/10/MoeCTF%202024%20Writeup/" title="MoeCTF 2024 Writeup">MoeCTF 2024 Writeup</a><time datetime="2024-08-10T06:25:36.000Z" title="Created 2024-08-10 14:25:36">2024-08-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By w8nn9z</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.14.0-b3"></script><script src="/js/main.js?v=4.14.0-b3"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.35/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = (ele) => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from(ele).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return
    
    codeMermaidEle.forEach(ele => {
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.innerHTML = `<pre class="mermaid-src" hidden>${ele.textContent}</pre>`
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js').then(runMermaidFn)
  }
  
  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>